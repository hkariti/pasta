---
- hosts: tv-h
  become: yes
  vars:
    downloads_group: downloads
  tasks:
    - name: Install packages
      apt: name={{item}} update_cache=yes state=present
      with_items:
        - python
        - git
        - vim
        - tmux
        - avahi-daemon

    - name: Mount downloads dir
      mount: name=/mnt/downloads fstype=ext4 src=LABEL=Downloads state=present

    - name: Create downloads group
      group: name=downloads gid=125 state=present
        

    - name: Disable suspend on lid close
      lineinfile: regexp=HandleLidSwitch= line="HandleLidSwitch=ignore" path=/etc/systemd/logind.conf
      notify: restart logind
  roles:
    - role: transmission
      secondary_groups: "{{ downloads_group }}"
    - role: couchpotato
      group: "{{ downloads_group }}"
    - role: sickrage
      group: "{{ downloads_group }}"
    - nginx
  handlers:
      - name: restart logind
        service: name=systemd-logind state=restarted
